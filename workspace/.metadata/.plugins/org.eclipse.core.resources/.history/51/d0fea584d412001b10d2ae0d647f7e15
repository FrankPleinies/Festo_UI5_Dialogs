"use strict";

sap.ui.define(["./Base.controller", "../model/formatter", "sap/ui/model/json/JSONModel", "sap/ui/core/Fragment", "sap/ui/core/BusyIndicator"], function (Controller, formatter, JSONModel, Fragment, BusyIndicator) {
  "use strict";

  var radioButtonGroupEnums = {
    RBGOne: {
      "No, use ResourceID": false,
      "Yes": true
    },
    RBGTwo: {
      "Auto assign": 0,
      "Only Cons": 1,
      "Only No Cons": 2,
      "Any - Cons and No Cons": 3
    },
    RBGThree: {
      "Mix": true,
      "Single Pool Name only": false
    }
  };
  return Controller.extend("y20_out_pick_s.controller.MainScreen", {
    formatter: formatter,
    initialQuantityValue: undefined,
    deviationCommand: undefined,
    warehouseTaskNumber: undefined,
    lastSetInfoDataOnLoadData: undefined,
    setInfoNoResource: undefined,
    isOneCyclePassed: false,
    currentTrolley: undefined,
    showDropOffErrorMessageOnSuccess: false,
    isResource: undefined,
    onInit: function onInit() {
      this.checkWhNumberAndWorkstation();
      this.setCurrentLoggedInUser();
      var isTouch = sap.ui.Device.support.touch;
      this.getView().addStyleClass(isTouch ? "sapUiSizeCozy" : "sapUiSizeCompact");
      isTouch && this.getView().byId("BlockLayout").addStyleClass("tablet-transform");
      this.onOpenScanDialog();
    },
    onAfterRendering: function onAfterRendering() {
      var _this = this;

      var isTouch = sap.ui.Device.support.touch;
      var reg = RegExp('customButton');
      setTimeout(function () {
        var btnArr = Array.from(document.getElementsByTagName("button")).filter(function (button) {
          return reg.test(button.className);
        });
        isTouch && btnArr.forEach(function (button) {
          return window.setTimeout(function () {
            return button.classList.add("customTabletButton");
          }, 0);
        });
        isTouch && _this.byId("firstSectionText").addStyleClass("customTextTablet");
        isTouch && _this.byId("secondCellTextOne").addStyleClass("sapUiSmallMarginTop");
        isTouch && _this.byId("secondCellTextTwo").addStyleClass("customTextTablet");

        _this.byId("fullDropBtn").addStyleClass("sapUiLargeMarginEnd");
      }, 0);
    },
    refreshModels: function refreshModels() {
      var models = this.getView().oModels;

      for (var modelName in models) {
        models[modelName].refresh();
      }
    },
    onOpenScanDialog: function onOpenScanDialog() {
      var view = this.getView();
      var popupDialogScan = this.byId("popupDialogScan");

      if (!popupDialogScan) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.popupDialogScan",
          controller: this
        }).then(function (popupDialogScan) {
          view.addDependent(popupDialogScan);
          popupDialogScan.open();
        });
      } else {
        this.byId("popupDialogScan").open();
      }
    },
    onConfirmDialog: function onConfirmDialog(event, setInfoData) {
      var _this2 = this;

      var warehouseNumber = this.whNumber;
      var dataInputTrolley = this.getView().byId("formScanInput");
      var activityArea = this.getView().byId("formPickAAInput");
      var rbgFirstSprw = this.getView().byId("rbgFirst").getSelectedButton().getText();
      var rbgSecondConsolidate = this.getView().byId("rbgSecond").getSelectedButton().getText();
      var rbgThirdPoolMix = this.getView().byId("rbgThird").getSelectedButton().getText();
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", true);
      this.setInfoNoResource = "(LGNUM='".concat(warehouseNumber, "',TROLLEY='',SPWR=").concat(radioButtonGroupEnums.RBGOne[rbgFirstSprw], ",AAREA='").concat(activityArea.getValue(), "',CONSOLIDATE='").concat(radioButtonGroupEnums.RBGTwo[rbgSecondConsolidate], "',POOL_MIX=").concat(radioButtonGroupEnums.RBGThree[rbgThirdPoolMix], ")");
      var setInfo = setInfoData ? setInfoData : "(LGNUM='".concat(warehouseNumber, "',TROLLEY='").concat(dataInputTrolley.getValue(), "',SPWR=").concat(radioButtonGroupEnums.RBGOne[rbgFirstSprw], ",AAREA='").concat(activityArea.getValue(), "',CONSOLIDATE='").concat(radioButtonGroupEnums.RBGTwo[rbgSecondConsolidate], "',POOL_MIX=").concat(radioButtonGroupEnums.RBGThree[rbgThirdPoolMix], ")");
      this.lastSetInfoDataOnLoadData = setInfo;
      this.showDropOffErrorMessageOnSuccess = false;
      activityArea.setValue();
      BusyIndicator.show();
      oModel.read("/StartPopupCollection" + setInfo, {
        urlParameters: {
          "$expand": "StartPopup_TONav,StartPopup_TrolleyNav"
        },
        useBatch: false,
        success: function success(data) {
          _this2.isResource = !radioButtonGroupEnums.RBGOne[rbgFirstSprw];

          _this2.setModels(data);

          _this2.buildStorageBin();

          var popupDialog = _this2.byId("popupDialogScan");

          popupDialog.close();
          BusyIndicator.hide();
          setTimeout(function () {
            _this2.getView().byId("scanInput").focus();
          }, 0);
        },
        error: function error(err) {
          BusyIndicator.hide();
          dataInputTrolley && dataInputTrolley.setValue("");

          if (_this2.isOneCyclePassed && _this2.currentTrolley) {
            _this2.onFullDropPressed(null, _this2.currentTrolley);

            _this2.showDropOffErrorMessageOnSuccess = true;
          } else {
            _this2.handleMessageResponse(err);
          }
        }
      });
    },
    setModels: function setModels(data) {
      var _this3 = this;

      var trolley = null;
      var models = [{
        modelTrolley: data
      }, {
        modelToNav: data.StartPopup_TONav
      }, {
        modelTrolleyNav: data.StartPopup_TrolleyNav
      }];
      models.forEach(function (model) {
        var name = Object.keys(model)[0];

        _this3.getView().setModel(new JSONModel(model[name]), name);
      });
      this.byId("blockLayoutCellFirst").setTitle("Storage Bin : ".concat(data.StartPopup_TONav.VLPLA));

      if (data.StartPopup_TrolleyNav.results.length > 0) {
        trolley = data.StartPopup_TrolleyNav.results[0].TROLLEY;
        this.byId("blockLayoutCellThird").setTitle("Resource : ".concat(trolley));
      }

      if (data.StartPopup_TONav.LSCK || data.StartPopup_TONav.ZEROSCK) {
        this.byId("redTextLabel").setText("Low Stock Check");
      } else {
        this.byId("redTextLabel").setText("");
      }

      this.warehouseTaskNumber = data.StartPopup_TONav.TANUM;
      this.initialQuantityValue = data.StartPopup_TONav.QUAN.QUAN;
      this.getView().byId("stepInputQuan").setMax(parseInt(this.initialQuantityValue)); //ako tonav e prazna i trolleynav ima trolley -> dropoff popup

      if (!this.warehouseTaskNumber && trolley) {
        this.loadDropOffRequestData(trolley, this.whNumber, true);
      }
    },
    onAutoAssignDialog: function onAutoAssignDialog() {
      var popupDialog = this.byId("popupDialogScan");
      popupDialog.close();
    },
    onGoToAssignPressed: function onGoToAssignPressed() {
      var url = window.location.protocol + "//" + window.location.host;
      window.location.href = url + "/sap/bc/ui5_ui5/sap/y20_deashutron2/index.html";
    },
    setCurrentLoggedInUser: function setCurrentLoggedInUser() {
      var _this4 = this;

      var xmlHttp = new XMLHttpRequest();

      xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
          var oUserData = JSON.parse(xmlHttp.responseText);

          _this4.byId("headerContentText").setText("User: ".concat(oUserData.id));
        }
      };

      xmlHttp.open("GET", "/sap/bc/ui2/start_up", false);
      xmlHttp.send(null);
    },
    buildStorageBin: function buildStorageBin(requestDataString) {
      var _this5 = this;

      var shelfs = 1;
      var shelfToDisplay = 1;
      var shelfSections = 3;
      var targetShelfSection = 1;
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_SBIN_SERVICES_SRV", true);
      var warehouseNumber = this.whNumber;
      var modelWarehouseTaskNav = this.getView().getModel("modelToNav").getData();
      BusyIndicator.show();
      var VlplaNum = requestDataString ? requestDataString : modelWarehouseTaskNav.VLPLA;
      var vlpla = encodeURIComponent(VlplaNum);
      oModel.read("/SbinEntSet(Lgnum='".concat(warehouseNumber, "',Lgpla='").concat(vlpla, "')"), {
        useBatch: false,
        success: function success(data) {
          BusyIndicator.hide();
          shelfs = parseInt(data.RackHeight); //Amount of levels

          shelfToDisplay = parseInt(data.Lvl_V); //Relevant level

          shelfSections = parseInt(data.LvlPositions); //Amount of positions in relevant level

          targetShelfSection = parseInt(data.Plpos); // Position to be marked in relevant level

          targetShelfSection = parseInt(data.Plpos); // Position to be marked in relevant level

          _this5.drawStorageBin(_this5.getView(), shelfs, shelfToDisplay, shelfSections, targetShelfSection);
        },
        error: function error() {
          return BusyIndicator.hide();
        }
      });
    },
    drawStorageBin: function drawStorageBin(view, shelfs, shelfToDisplay, shelfSections, targetShelfSection) {
      var container = view.byId("ShelfDisplay");
      container.destroyItems();

      for (var count = 1; count <= shelfs; count++) {
        var shelf = getBox("40px", "70%", "Start", "Center", "stack");

        if (count === shelfToDisplay) {
          for (var sections = 1; sections <= shelfSections; sections++) {
            if (sections === targetShelfSection) {
              var innerBoxSelected = getBox("30px", "100%", "Start", "Center", "itemNotRelevant");

              if (sections == 1) {
                innerBoxSelected.addStyleClass("sapUiSmallMarginBegin");
              }

              if (sections == shelfSections) {
                innerBoxSelected.addStyleClass("sapUiSmallMarginEnd");
              }

              innerBoxSelected.setLayoutData(new sap.m.FlexItemData({
                growFactor: 1
              }));
              shelf.addItem(innerBoxSelected);
            } else {
              var innerBox = getBox("30px", "100%", "Start", "Center", "itemRelevant");

              if (sections == 1) {
                innerBox.addStyleClass("sapUiSmallMarginBegin");
              }

              if (sections == shelfSections) {
                innerBox.addStyleClass("sapUiSmallMarginEnd");
              }

              innerBox.setLayoutData(new sap.m.FlexItemData({
                growFactor: 1
              }));
              shelf.addItem(innerBox);
            }
          }
        }

        container.addItem(shelf);
      }

      function getBox(height, width, alignItems, justifyContent, styleClass) {
        return new sap.m.FlexBox({
          height: height,
          width: width,
          alignItems: alignItems,
          justifyContent: justifyContent
        }).addStyleClass(styleClass);
      }
    },
    onScanSourceSubmit: function onScanSourceSubmit() {
      var _this6 = this;

      var requestObject = this.getView().getModel("requestsData").getData().Objects[0];
      var input = this.getView().byId("scanInput");
      var focusInput = this.getView().byId("scanDestPosInput");
      var scannedData = input.getValue();

      if (scannedData) {
        input.setValue();
        var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", true);
        var requestBody = JSON.parse(JSON.stringify(requestObject));
        requestBody.Scan_WarehouseTaskNav = this.getView().getModel("modelToNav").getData();
        requestBody.LGNUM = this.whNumber;
        requestBody.SCAN = scannedData;
        requestBody.Scan_WarehouseTaskNav.QUAN.QUAN = requestBody.Scan_WarehouseTaskNav.QUAN.QUAN.toString();
        oModel.create("/ScanCollection", requestBody, {
          success: function success(successData, response) {
            _this6.handleMessageResponse(response);

            _this6.getView().setModel(new JSONModel(successData.Scan_WarehouseTaskNav), "modelToNav");

            focusInput.focus();

            _this6.displayMessageInFooter("Verification Successfull!", "info");
          },
          error: function error(err) {
            return _this6.handleMessageResponse(err);
          }
        });
      } else {
        this.displayMessageInFooter("Nothing was entered!", "info");
      }
    },
    onScanDestPosSubmit: function onScanDestPosSubmit() {
      var _this7 = this;

      var requestObject = this.getView().getModel("requestsData").getData().Objects[0];
      var input = this.getView().byId("scanDestPosInput");
      var scannedData = input.getValue();

      if (scannedData) {
        input.setValue();
        var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", true);
        var isResource = this.isResource;
        var requestBody = JSON.parse(JSON.stringify(requestObject));
        requestBody.Scan_WarehouseTaskNav = this.getView().getModel("modelToNav").getData();
        requestBody.Scan_TrolleyNav = this.getView().getModel("modelTrolleyNav").getData().results[0];
        requestBody.LGNUM = this.whNumber;
        requestBody.SCAN = scannedData;

        if (!requestBody.Scan_TrolleyNav) {
          requestBody.Scan_TrolleyNav = {
            LGNUM: this.whNumber
          };
        }

        requestBody.Scan_WarehouseTaskNav.QUAN.QUAN = requestBody.Scan_WarehouseTaskNav.QUAN.QUAN.toString();
        requestBody.Scan_WarehouseTaskNav.IS_RESOURCE = isResource;
        oModel.create("/ScanCollection", requestBody, {
          success: function success(successData) {
            _this7.getView().setModel(new JSONModel(successData.Scan_WarehouseTaskNav), "modelToNav");

            _this7.getView().byId("arrowButton").focus();

            _this7.byId("destHuType").setText(successData.Scan_TrolleyNav.HUTYPE);

            _this7.byId("blockLayoutCellThird").setTitle("Resource : ".concat(successData.Scan_TrolleyNav.TROLLEY)); //const stringSetData = this.setInfoNoResource


            var trolley = successData.Scan_TrolleyNav.TROLLEY;
            _this7.currentTrolley = trolley; // const position = 23;
            // const newSetDataOutput = [stringSetData.slice(0, position), trolley, stringSetData.slice(position)].join('');
            // this.lastSetInfoDataOnLoadData = newSetDataOutput

            _this7.isOneCyclePassed = true;

            _this7.displayMessageInFooter("Verification Successfull!", "info"); //ako e true ne pravq request


            if (!successData.Scan_WarehouseTaskNav.NO_ARROW) {
              _this7.onArrowButtonPressed();
            } else {
              _this7.onConfirmDialog(null, _this7.lastSetInfoDataOnLoadData);
            }
          },
          error: function error(err) {
            return _this7.handleMessageResponse(err);
          }
        });
      } else {
        this.displayMessageInFooter("Nothing was entered!", "info");
      }
    },
    onArrowButtonPressed: function onArrowButtonPressed() {
      var _this8 = this;

      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", true);
      var modelToNavData = this.getView().getModel("modelToNav").getData();
      var lowStock = modelToNavData.LSCK;
      var zeroStock = modelToNavData.ZEROSCK;
      var stepInput = this.getView().byId("stepInputQuan");

      if (parseInt(this.initialQuantityValue) != parseInt(stepInput.getValue())) {
        this.loadDeviationRequestData(true);
      } else {
        var requestBody = {};
        requestBody = this.getView().getModel("modelToNav").getData();
        requestBody.WarehouseTask_TrolleyNav = this.getView().getModel("modelTrolleyNav").getData().results[0];
        requestBody.QUAN.QUAN = requestBody.QUAN.QUAN.toString();

        if (!requestBody.WarehouseTask_TrolleyNav) {
          requestBody.WarehouseTask_TrolleyNav = {
            LGNUM: this.whNumber
          };
        }

        oModel.create("/WarehouseTaskCollection", requestBody, {
          success: function success(successData, response) {
            _this8.handleMessageResponse(response, null, true); //update models


            if (zeroStock) {
              _this8.loadZeroStockRequestData(true);
            } else if (lowStock) {
              _this8.loadLowStockRequestData(true);
            } else {
              //reload data
              _this8.onConfirmDialog(null, _this8.lastSetInfoDataOnLoadData);
            }
          },
          error: function error(err) {
            return _this8.handleMessageResponse(err);
          }
        });
      }
    },
    onInfoPressed: function onInfoPressed() {
      var _this9 = this;

      var taskNumberVal = this.getView().getModel("modelToNav").getData().TANUM;
      var lgNum = new sap.ui.model.Filter("LGNUM", "EQ", this.whNumber);
      var taskNumber = new sap.ui.model.Filter("TANUM", "EQ", taskNumberVal);
      var arr = [lgNum, taskNumber];
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", {
        useBatch: false
      });
      oModel.read("/ItemTextCollection", {
        filters: arr,
        success: function success(data, resp) {
          _this9.getView().setModel(new JSONModel(data), "informationCollectionModel");

          _this9.handleMessageResponse(resp);

          if (data.results.length > 0) {
            _this9.onOpenInfoDialog();
          }
        },
        error: function error(err) {
          _this9.handleMessageResponse(err);
        }
      });
    },
    onOpenInfoDialog: function onOpenInfoDialog() {
      var view = this.getView();
      var popupDialogInfo = this.byId("popupDialogInfo");

      if (!popupDialogInfo) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogInfo",
          controller: this
        }).then(function (popupDialogInfo) {
          view.addDependent(popupDialogInfo);
          popupDialogInfo.open();
        });
      } else {
        this.byId("popupDialogInfo").open();
      }
    },
    onCloseInfoDialog: function onCloseInfoDialog() {
      var popupDialog = this.byId("popupDialogInfo");
      popupDialog.close();
    },
    loadDeviationRequestData: function loadDeviationRequestData(openPopup) {
      var _this10 = this;

      var dataModelWarehouseTask = this.getView().getModel("modelToNav").getData();
      var stepInput = this.getView().byId("stepInputQuan");
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", {
        useBatch: false
      });
      var warehouseNumber = this.whNumber;
      var trolley = this.currentTrolley;
      var tanum = dataModelWarehouseTask.TANUM;
      var nistm = stepInput.getValue().toString();
      var nlenr = dataModelWarehouseTask.NLENR;
      var setInfo = "(Lgnum='".concat(warehouseNumber, "',Tanum='").concat(tanum, "',Nistm='").concat(nistm, "',Trolley='").concat(trolley, "',Nlenr='").concat(nlenr, "')");
      BusyIndicator.show();
      oModel.read("/LoadPickDeviationSet" + setInfo, {
        success: function success(data) {
          _this10.getView().setModel(new JSONModel(data), "modelDeviation");

          BusyIndicator.hide();
          openPopup && _this10.onOpenDeviationDialog();
        },
        error: function error(err) {
          _this10.handleMessageResponse(err);

          BusyIndicator.hide();
        }
      });
    },
    onOpenDeviationDialog: function onOpenDeviationDialog() {
      var view = this.getView();
      var popupDialogDeviation = this.byId("popupDialogDeviation");

      if (!popupDialogDeviation) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogDeviation",
          controller: this
        }).then(function (popupDialogDeviation) {
          view.addDependent(popupDialogDeviation);
          popupDialogDeviation.open();
        });
      } else {
        this.byId("popupDialogDeviation").open();
      }
    },
    afterOpenDeviation: function afterOpenDeviation() {
      var deviationAdjustButton = this.getView().byId("deviationAdjustButton");
      var deviationBlockButton = this.getView().byId("deviationBlockButton");
      var deviationModelData = this.getView().getModel("modelDeviation").getData();

      if (parseInt(deviationModelData.Nistm) == parseInt(this.initialQuantityValue)) {
        deviationAdjustButton.setEnabled(false);
        deviationBlockButton.setEnabled(false);
      } else {
        deviationAdjustButton.setEnabled(true);
        deviationBlockButton.setEnabled(true);
      }
    },
    onDeviationStepChangedPressed: function onDeviationStepChangedPressed() {
      this.afterOpenDeviation();
    },
    onDeviationAdjustPressed: function onDeviationAdjustPressed(event, command) {
      this.deviationCommand = command ? command : "03";
      var deviationAdjustButton = this.getView().byId("deviationAdjustButton");
      var deviationBlockButton = this.getView().byId("deviationBlockButton");
      deviationAdjustButton.setEnabled(false);
      deviationBlockButton.setEnabled(false);
    },
    onDeviationBlockStockPressed: function onDeviationBlockStockPressed() {
      this.onDeviationAdjustPressed(null, "04");
    },
    onDeviationPostReqest: function onDeviationPostReqest(devCommand) {
      var _this11 = this;

      BusyIndicator.show();
      var popupDialog = this.byId("popupDialogDeviation");
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", true);
      var requestBody = this.getView().getModel("modelDeviation").getData();
      var stepInputDeviation = this.getView().byId("stepInputDeviation").getValue().toString();
      var modelToNavData = this.getView().getModel("modelToNav").getData();
      requestBody.UserComm = devCommand;
      requestBody.Nistm = stepInputDeviation;
      requestBody.Nlenr = modelToNavData.NLENR;
      oModel.create("/LoadPickDeviationSet ", requestBody, {
        success: function success(successData, response) {
          popupDialog.close();
          BusyIndicator.hide();

          if (!response.headers) {
            response = response.response;
          }

          var isThereSuccessMessage = !!response.headers["sap-message"];

          if (isThereSuccessMessage) {
            _this11.handleMessageResponse(response, _this11.onConfirmDialog.bind(_this11, null, _this11.lastSetInfoDataOnLoadData));
          } else {
            _this11.onConfirmDialog(null, _this11.lastSetInfoDataOnLoadData);
          }
        },
        error: function error(err) {
          _this11.handleMessageResponse(err);

          popupDialog.close();
          BusyIndicator.hide();
        }
      });
    },
    onCloseDeviationDialog: function onCloseDeviationDialog() {
      if (this.deviationCommand) {
        this.onDeviationPostReqest(this.deviationCommand);
      } else {
        var popupDialog = this.byId("popupDialogDeviation");
        popupDialog.close();
      }
    },
    onOpenDropOffDialog: function onOpenDropOffDialog() {
      var view = this.getView();
      var popupDialogDropOff = this.byId("popupDialogDropOff");

      if (!popupDialogDropOff) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogDropOff",
          controller: this
        }).then(function (popupDialogDropOff) {
          view.addDependent(popupDialogDropOff);
          popupDialogDropOff.open();
        });
      } else {
        this.byId("popupDialogDropOff").open();
      }
    },
    loadDropOffRequestData: function loadDropOffRequestData(trolleyData, warehouseNumber, openPopup) {
      var _this12 = this;

      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", {
        useBatch: false
      });
      var trolley = trolleyData ? trolleyData : "";
      var setInfo = "(Lgnum='".concat(warehouseNumber, "',Trolley='").concat(trolley, "')");
      BusyIndicator.show();
      oModel.read("/PickDropOffTrolScrSet" + setInfo, {
        success: function success(data) {
          _this12.getView().setModel(new JSONModel(data), "modelDropOff");

          BusyIndicator.hide();
          openPopup && _this12.onOpenDropOffDialog();
        },
        error: function error(err) {
          BusyIndicator.hide();
          var errorCode = JSON.parse(err.responseText).error.code;

          if (errorCode === "Y20_UI5/045") {
            _this12.onOpenScanDialog();
          } else {
            _this12.handleMessageResponse(err);
          }
        }
      });
    },
    onConfirmDropOffDialog: function onConfirmDropOffDialog() {
      var _this13 = this;

      var popupDialog = this.byId("popupDialogDropOff");
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", true);
      var input = this.getView().byId("scanPopupDropOffInput");
      var requestBody = this.getView().getModel("modelDropOff").getData();
      requestBody.LgplaVerifScan = input.getValue();
      oModel.create("/PickDropOffTrolScrSet", requestBody, {
        success: function success() {
          popupDialog.close();

          if (_this13.showDropOffErrorMessageOnSuccess) {
            _this13.showDropOffErrorMessageOnSuccess = false; //show error

            _this13.createMessageBox({
              severity: "error",
              message: "No Suitable Warehouse Tasks found!"
            }, _this13.onOpenScanDialog.bind(_this13));
          } else {
            _this13.onOpenScanDialog();
          }
        },
        error: function error(err) {
          return _this13.handleMessageResponse(err);
        }
      });
    },
    afterOpenDropOff: function afterOpenDropOff() {
      var _this14 = this;

      setTimeout(function () {
        var dropOffInput = _this14.getView().byId("scanPopupDropOffInput");

        dropOffInput.setValue();
        dropOffInput.focus();
      }, 0);
    },
    onFullDropPressed: function onFullDropPressed(event, trol) {
      var dataModelTrolleyResults = this.getView().getModel("modelTrolleyNav").getData().results;
      var trolleyEntry = dataModelTrolleyResults ? dataModelTrolleyResults[0].TROLLEY : this.currentTrolley;

      if (trolleyEntry || trol) {
        var trolley = trol ? trol : trolleyEntry;
        this.loadDropOffRequestData(trolley, this.whNumber, true);
      } else {
        sap.m.MessageToast.show("Invalid Trolley Data!");
      }
    },
    //Zero Stock
    onOpenZeroStockCheckDialog: function onOpenZeroStockCheckDialog() {
      var view = this.getView();
      var popupDialogZero = this.byId("popupDialogZeroStockCheck");

      if (!popupDialogZero) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogZeroStockCheck",
          controller: this
        }).then(function (popupDialogZero) {
          view.addDependent(popupDialogZero);
          popupDialogZero.open();
        });
      } else {
        this.byId("popupDialogZeroStockCheck").open();
      }
    },
    loadZeroStockRequestData: function loadZeroStockRequestData(openPopup) {
      var _this15 = this;

      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", {
        useBatch: false
      });
      var whTask = this.warehouseTaskNumber;
      var whNumber = this.whNumber;
      var setInfo = "(Lgnum='".concat(whNumber, "',Tanum='").concat(whTask, "')");
      BusyIndicator.show();
      oModel.read("/LowStockCheckPISet" + setInfo, {
        success: function success(data) {
          _this15.getView().setModel(new JSONModel(data), "modelZeroStockCheck");

          BusyIndicator.hide();
          openPopup && _this15.onOpenZeroStockCheckDialog();
        },
        error: function error(err) {
          _this15.handleMessageResponse(err);

          BusyIndicator.hide();
        }
      });
    },
    onPostZeroStockDialog: function onPostZeroStockDialog(userCommand) {
      var _this16 = this;

      var popupDialog = this.byId("popupDialogZeroStockCheck");
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", true);
      var stepInput = this.getView().byId("stepInputZeroStockCheck");
      var requestBody = this.getView().getModel("modelZeroStockCheck").getData();
      var modelToNavData = this.getView().getModel("modelToNav").getData();
      requestBody.Qty = stepInput.getValue().toString();
      requestBody.UserComm = userCommand;
      requestBody.HuidentScan = modelToNavData.NLENR;
      BusyIndicator.show();
      oModel.create("/LowStockCheckPISet ", requestBody, {
        success: function success(successData, response) {
          _this16.handleMessageResponse(response);

          _this16.onConfirmDialog(null, _this16.lastSetInfoDataOnLoadData);

          popupDialog.close();
          BusyIndicator.hide();
        },
        error: function error(err) {
          _this16.handleMessageResponse(err);

          _this16.onConfirmDialog(null, _this16.lastSetInfoDataOnLoadData);

          popupDialog.close();
          BusyIndicator.hide();
        }
      });
    },
    onZeroStockCheckYesButtonPressed: function onZeroStockCheckYesButtonPressed() {
      this.onPostZeroStockDialog("02");
    },
    onZeroStockCheckNoButtonPressed: function onZeroStockCheckNoButtonPressed() {
      this.byId("stepInputZeroStockCheck").setEnabled(true);
      this.byId("ZeroStockCheckAdjustButton").setEnabled(true);
    },
    onZeroStockCheckAdjustPressed: function onZeroStockCheckAdjustPressed() {
      this.onPostZeroStockDialog("01");
    },
    afterOpenZeroStockCheck: function afterOpenZeroStockCheck() {
      var _this17 = this;

      setTimeout(function () {
        _this17.getView().byId("zeroStockCheckYesButton").focus();
      }, 0);
      var zeroStockStepInput = this.byId("stepInputZeroStockCheck");
      zeroStockStepInput.setEnabled(false);
      zeroStockStepInput.setValue(0);
      this.byId("ZeroStockCheckAdjustButton").setEnabled(false);
    },
    //Low Stock
    onOpenLowStockCheckDialog: function onOpenLowStockCheckDialog() {
      var view = this.getView();
      var popupDialogLow = this.byId("popupDialogLowStockCheck");

      if (!popupDialogLow) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogLowStockCheck",
          controller: this
        }).then(function (popupDialogLow) {
          view.addDependent(popupDialogLow);
          popupDialogLow.open();
        });
      } else {
        this.byId("popupDialogLowStockCheck").open();
      }
    },
    loadLowStockRequestData: function loadLowStockRequestData(openPopup) {
      var _this18 = this;

      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", {
        useBatch: false
      });
      var whTask = this.warehouseTaskNumber;
      var whNumber = this.whNumber;
      var setInfo = "(Lgnum='".concat(whNumber, "',Tanum='").concat(whTask, "')");
      BusyIndicator.show();
      oModel.read("/LowStockCheckMatNrPISet" + setInfo, {
        success: function success(data) {
          _this18.getView().setModel(new JSONModel(data), "modelLowStock");

          BusyIndicator.hide();
          openPopup && _this18.onOpenLowStockCheckDialog();
        },
        error: function error(err) {
          _this18.handleMessageResponse(err);

          BusyIndicator.hide();
        }
      });
    },
    onPostLowStockDialog: function onPostLowStockDialog(userCommand) {
      var _this19 = this;

      var popupDialog = this.byId("popupDialogLowStockCheck");
      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICK_POP_UPS_SRV", true);
      var requestBody = this.getView().getModel("modelLowStock").getData();
      requestBody.Qty = requestBody.Qty.toString();
      requestBody.UserComm = userCommand;
      BusyIndicator.show();
      oModel.create("/LowStockCheckMatNrPISet ", requestBody, {
        success: function success(successData, response) {
          BusyIndicator.hide();

          _this19.handleMessageResponse(response);

          _this19.onConfirmDialog(null, _this19.lastSetInfoDataOnLoadData);

          popupDialog.close();
        },
        error: function error(err) {
          BusyIndicator.hide();

          _this19.handleMessageResponse(err);

          popupDialog.close();

          _this19.onOpenScanDialog();
        }
      });
    },
    onLowStockCheckAdjustPressed: function onLowStockCheckAdjustPressed() {
      this.onPostLowStockDialog("01");
    },
    // Change Queue
    onSkipButtonPress: function onSkipButtonPress() {
      this.onOpenChangeQueueDialog();
    },
    onOpenChangeQueueDialog: function onOpenChangeQueueDialog() {
      var view = this.getView();
      var popupDialogChangeQueue = this.byId("popupDialogChangeQueue");

      if (!popupDialogChangeQueue) {
        Fragment.load({
          id: view.getId(),
          name: "y20_out_pick_s.view.dialogs.PopupDialogChangeQueue",
          controller: this
        }).then(function (popupDialogChangeQueue) {
          view.addDependent(popupDialogChangeQueue);
          popupDialogChangeQueue.open();
        });
      } else {
        this.byId("popupDialogChangeQueue").open();
      }
    },
    onChangeQueueClose: function onChangeQueueClose() {
      this.byId("popupDialogChangeQueue").close();
    },
    onChangeQueueSubmit: function onChangeQueueSubmit() {
      var _this20 = this;

      var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/Y20_EWM_OUT_PICKING_SINGLE_SRV", {
        useBatch: false,
        defaultUpdateMethod: "PUT"
      });
      var warehouseNumber = this.whNumber;
      var setInfo = "(LGNUM='".concat(warehouseNumber, "')");
      var requestBody = JSON.parse(JSON.stringify(this.getView().getModel("modelToNav").getData()));
      requestBody.UCOMM = "01";
      oModel.update("/WarehouseTaskCollection" + setInfo, requestBody, {
        success: function success(successData, response) {
          _this20.handleMessageResponse(response);

          _this20.onConfirmDialog(null, _this20.lastSetInfoDataOnLoadData);
        },
        error: function error(err) {
          return _this20.handleMessageResponse(err);
        }
      });
    },
    afterCloseChangeQueue: function afterCloseChangeQueue() {
      var _this21 = this;

      setTimeout(function () {
        _this21.byId("customButton").focus();
      }, 0);
    },
    afterOpenChangeQueue: function afterOpenChangeQueue() {
      var _this22 = this;

      setTimeout(function () {
        var changeQueueInput = _this22.byId("changeQueueInput");

        changeQueueInput.setValue();
        changeQueueInput.focus();
      }, 0);
    },
    onAfterOpenScanDialog: function onAfterOpenScanDialog() {
      var confirmSubmitButton = this.getView().byId("confirmSubmitButton");
      var rbgFirstSprw = this.getView().byId("rbgFirst").getSelectedButton().getText();
      var inputResource = this.getView().byId("formScanInput");

      if (this.trolleyQuery) {
        inputResource.setValue(this.trolleyQuery);
      }

      if (!radioButtonGroupEnums.RBGOne[rbgFirstSprw]) {
        inputResource.setEnabled(true);

        if (inputResource.getValue()) {
          inputResource.setValueState(sap.ui.core.ValueState.None);
          confirmSubmitButton.setEnabled(true);
        } else {
          inputResource.setValueState(sap.ui.core.ValueState.Error);
          inputResource.setValueStateText("Enter Resource");
          confirmSubmitButton.setEnabled(false);
        }
      } else {
        inputResource.setValueState(sap.ui.core.ValueState.None);
        inputResource.setEnabled(false);
        inputResource.setValue();
        confirmSubmitButton.setEnabled(true);
      }
    },
    onRadioButtonGroupFirstSelect: function onRadioButtonGroupFirstSelect() {
      this.onAfterOpenScanDialog();
    },
    onInputResourceChange: function onInputResourceChange() {
      this.onAfterOpenScanDialog();
    }
  });
});